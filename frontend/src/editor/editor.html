<!DOCTYPE html>
<html>
  <head>
    <title>Editor</title>
    <script src="vue.js" type="text/javascript"></script>
    <script type="text/javascript">
    </script>
    <link href="editor.css" rel="stylesheet">
    <link href="edit_event_modal.css" rel="stylesheet">
    <link href="form.css" rel="stylesheet">
  </head>
  <body>
    <div id="vue_root">
      <div v-cloak v-if="importingWorkspace">
        <div class="modal_background">
          &nbsp;
        </div>

        <div class="modal edit_text_modal">
          <div class="modal_title">ワークスペースの読み込み</div>
          
          <form class="modal_content" @submit.prevent="onSubmitImageAsset">
            <div class="edit_text_modal_content">
              <div class="edit_text_modal_form">
                <div class="form_columns_row">
                  <div class="form_row">
                    <div class="form_row_label">
                      ファイル選択
                    </div>
  
                    <input type="file" @change="selectWorkspaceFile($event)">
                  </div>  
                </div>
              </div>

              <div class="modal_bottom_control">
                <button class="form_button" @click="importingWorkspace=false" type="button">キャンセル</button>  
              </div>
            </div>
          </form>
        </div>
      </div>

      <div v-cloak v-if="editingAsset">
        <div class="modal_background">
          &nbsp;
        </div>
  
        <div class="modal edit_text_modal" v-if="editingAsset?.type === 'text' && editingAsset.text">
          <div class="modal_title">テキストの編集</div>
          
          <form class="modal_content" @submit.prevent="onSubmitTextAsset">
            <div class="edit_text_modal_content">
              <div class="edit_text_modal_form">
                <div class="form_row">
                  <div class="form_row_label">
                    アセット名
                  </div>

                  <input type="text" class="form_input_text" required v-model="editingAsset.name">
                </div>  

                <div class="form_row">
                  <div class="form_row_label">
                    表示内容
                  </div>

                  <input type="text" class="form_input_text" v-model="editingAsset.text.content">
                </div>  

                <div class="form_columns_row">
                  <div class="form_row">
                    <div class="form_row_label">
                      文字サイズ
                    </div>
  
                    <input type="number" class="form_input_number" v-model="editingAsset.text.fontSize">
                  </div>  
  
                  <div class="form_row">
                    <div class="form_row_label">
                      padding
                    </div>
  
                    <input type="number" class="form_input_number" v-model="editingAsset.text.padding">
                  </div>  
  
                  <div class="form_row">
                    <div class="form_row_label">
                      行の高さ
                    </div>
  
                    <input type="number" class="form_input_number" v-model="editingAsset.text.lineHeight">
                  </div>  
                </div>

                <div class="form_row">
                  <div class="form_row_label">
                    文字色
                  </div>

                  <input type="color" class="form_input_color" v-model="editingAsset.text.textColor" required>
                </div>  

                <div class="form_columns_row">
                  <div class="form_row">
                    <button class="form_button" type="button" :disabled="editingAsset.text.backgroundColor" @click="clickEnableBackgroundColor">背景色を設定</button>
                  </div>
                  <div class="form_row">
                    <button class="form_button" type="button" :disabled="!editingAsset.text.backgroundColor" @click="clickDisableBackgroundColor">背景色を削除</button>
                  </div>
                </div>

                <div class="form_row" v-if="editingAsset.text.backgroundColor">
                  <div class="form_row_label">
                    背景色
                  </div>

                  <input type="color" class="form_input_color" v-model="editingAsset.text.backgroundColor" required>
                </div>  
                
                <div class="form_columns_row">
                  <div class="form_row">
                    <button class="form_button" type="button" :disabled="editingAsset.text.borderEnabled" @click="clickEnableBorder">罫線を設定</button>
                  </div>
                  <div class="form_row">
                    <button class="form_button" type="button" :disabled="!editingAsset.text.borderEnabled" @click="clickDisableBorder">罫線を削除</button>
                  </div>
                </div>

                <div class="form_columns_row" v-if="editingAsset.text.borderEnabled">
                  <div class="form_row">
                    <div class="form_row_label">
                      罫線の種類
                    </div>
  
                    <select class="form_select" v-model="editingAsset.text.borderStyle" required>
                      <option value="solid">実線</option>
                    </select>
                  </div>  
  
                  <div class="form_row">
                    <div class="form_row_label">
                      罫線の幅
                    </div>
  
                    <input type="number" class="form_input_number" v-model="editingAsset.text.borderWidth" min="1" required>
                  </div>  
  
                  <div class="form_row">
                    <div class="form_row_label">
                      罫線の色
                    </div>
  
                    <input type="color" class="form_input_color" v-model="editingAsset.text.borderColor" required>
                  </div>  
                </div>
              </div>

              <div class="modal_bottom_control">
                <button class="form_button" type="submit">OK</button>
                <button class="form_button" @click="clickCancelEditingTextAsset" type="button">キャンセル</button>  
              </div>
            </div>
          </form>
        </div>

        <div class="modal edit_text_modal" v-if="editingAsset?.type === 'image' && editingAsset.image">
          <div class="modal_title">画像の編集</div>
          
          <form class="modal_content" @submit.prevent="onSubmitImageAsset">
            <div class="edit_text_modal_content">
              <div class="edit_text_modal_form">
                <div class="form_row">
                  <div class="form_row_label">
                    アセット名
                  </div>

                  <input type="text" class="form_input_text" required v-model="editingAsset.name">
                </div>  

                <div class="form_row">
                  <div class="form_row_label">
                    表示内容
                  </div>

                  <div>
                    <img :src="editingAsset.image.source" class="edit_image_modal_image"><br>
                    <input type="text" :value="editingAsset.image.source" required placeholder="(画像選択で自動入力)">
                  </div>
                </div>  

                <div class="form_columns_row">
                  <div class="form_row">
                    <div class="form_row_label">
                      画像の変更
                    </div>
  
                    <input type="file" @change="selectImageFile($event)">
                  </div>  
                </div>
              </div>

              <div class="modal_bottom_control">
                <button class="form_button" type="submit">OK</button>
                <button class="form_button" @click="clickCancelEditingImageAsset" type="button">キャンセル</button>  
              </div>
            </div>
          </form>
        </div>
      </div>

      <div v-show="editingFrameEvent" v-cloak>
        <div class="modal_background">
          &nbsp;
        </div>
  
        <div class="modal edit_event_modal">
          <div class="modal_title">イベントの編集</div>
          <form class="modal_content" @submit.prevent="onSubmit">
            <div class="modal_content_left" v-if="editingFrameEvent">
              <div class="modal_content_left_content">
                <div class="form_row">
                  <div class="form_row_label">
                    イベントの種別
                  </div>
    
                  <select class="form_select" v-model="editingFrameEvent.type" @change="onFrameEventTypeChanged" required>
                    <option value="defineLabel" required>ラベルを定義</option>
                    <option value="putImage">画像を配置</option>
                    <option value="putText">テキストを配置</option>
                    <option value="executeAction">アクションを実行</option>
                    <option value="doNothing">何もしない</option>
                    <option value="defineComponentUserFunction">ユーザ関数を定義</option>
                  </select>
                </div>
    
                <template v-if="editingFrameEvent.type === 'executeAction' && editingFrameEvent.executeAction">
                  <div class="form_row">
                    <div class="form_row_label">
                      アクションの種別
                    </div>
      
                    <select class="form_select" v-model="editingFrameEvent.executeAction.type" @change="onFrameEventActionTypeChanged" required>
                      <option value="eraseLayers">指定深度を消去</option>
                      <option value="play">再生</option>
                      <option value="stop">停止</option>
                      <option value="gotoAndPlay">指定ラベルへジャンプして再生</option>
                      <option value="setTextValue">テキストの表示内容を更新</option>
                      <option value="executeScript">スクリプトを実行</option>
                      <option value="callComponentUserFunction">ユーザ関数を呼び出し</option>
                      <option value="registerGlobalKeydownListener">キー押下リスナーを登録</option>
                      <option value="unregisterGlobalKeydownListener">キー押下リスナーを登録解除</option>
                      <option value="startUserTimer">タイマーを開始</option>
                      <option value="clearUserTimer">タイマーを解除</option>
                    </select>
                  </div>
                  
                  <template v-if="editingFrameEvent.executeAction.type === 'gotoAndPlay' && editingFrameEvent.executeAction.gotoAndPlay">
                    <div class="form_row">
                      <div class="form_row_label">
                        ジャンプ先
                      </div>
    
                      <select class="form_input_text" v-model="editingFrameEvent.executeAction.gotoAndPlay.destination" required>
                        <option v-for="labelName in allLabelNames" :value="labelName">{{labelName}}</option>
                      </select>
                    </div>  
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'eraseLayers' && editingFrameEvent.executeAction.eraseLayers">
                    <div class="form_row">
                      <div class="form_row_label">
                        深度(全て消去の場合はallと入力)
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.eraseLayers.depths[0]" required pattern="^[0-9]+$|^all$">
                    </div>  
                  </template>
                  
                  <template v-if="editingFrameEvent.executeAction.type === 'setTextValue' && editingFrameEvent.executeAction.setTextValue">
                    <div class="form_row">
                      <div class="form_row_label">
                        オブジェクトID
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.setTextValue.objectId" required pattern="^\w+$">
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        表示内容
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.setTextValue.value">
                    </div>  
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'callComponentUserFunction' && editingFrameEvent.executeAction.callComponentUserFunction">
                    <div class="form_row">
                      <div class="form_row_label">
                        ユーザ関数名
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.callComponentUserFunction.name" required>
                    </div>  
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'registerGlobalKeydownListener' && editingFrameEvent.executeAction.registerGlobalKeydownListener">
                    <div class="form_row">
                      <div class="form_row_label">
                        リスナーID
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.registerGlobalKeydownListener.listenerId" required>
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        ユーザ関数名
                      </div>
    
                      <select class="form_input_text" v-model="editingFrameEvent.executeAction.registerGlobalKeydownListener.componentUserFunctionName" required>
                        <option v-for="labelName in allUserFunctionNames" :value="labelName">{{labelName}}</option>
                      </select>
                    </div>  
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'unregisterGlobalKeydownListener' && editingFrameEvent.executeAction.unregisterGlobalKeydownListener">
                    <div class="form_row">
                      <div class="form_row_label">
                        リスナーID
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.unregisterGlobalKeydownListener.listenerId" required>
                    </div>
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'startUserTimer' && editingFrameEvent.executeAction.startUserTimer">
                    <div class="form_row">
                      <div class="form_row_label">
                        リスナーID
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.startUserTimer.listenerId" required>
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        ユーザ関数名
                      </div>
    
                      <select class="form_input_text" v-model="editingFrameEvent.executeAction.startUserTimer.componentUserFunctionName" required>
                        <option v-for="labelName in allUserFunctionNames" :value="labelName">{{labelName}}</option>
                      </select>
                    </div>
                    
                    <div class="form_row">
                      <div class="form_row_label">
                        間隔(1000で1秒)
                      </div>
    
                      <input type="number" class="form_input_number" v-model="editingFrameEvent.executeAction.startUserTimer.interval" required min="0" max="99999">
                    </div>
                  </template>

                  <template v-if="editingFrameEvent.executeAction.type === 'clearUserTimer' && editingFrameEvent.executeAction.clearUserTimer">
                    <div class="form_row">
                      <div class="form_row_label">
                        リスナーID
                      </div>
    
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.executeAction.clearUserTimer.listenerId" required>
                    </div>
                  </template>
                  
                  <template v-if="editingFrameEvent.executeAction.type === 'executeScript' && editingFrameEvent.executeAction.executeScript">                    
                    <div class="form_row">
                      <div class="form_row_label">
                        スクリプト
                      </div>
    
                      <textarea class="form_textarea" v-model="editingFrameEvent.executeAction.executeScript.content" required></textarea>
                    </div>

                    <div class="form_row">
                      <button class="form_button" type="button" @click="checkScript(editingFrameEvent.executeAction.executeScript.content)">スクリプトの構文チェック</button>
                    </div>
                  </template>
                </template>

                <div class="form_row" v-if="editingFrameEvent.type === 'defineLabel' && editingFrameEvent.defineLabel">
                  <div class="form_row_label">
                    ラベル名
                  </div>

                  <input type="text" class="form_input_text" v-model="editingFrameEvent.defineLabel.label" required>
                </div>
                
                <template v-if="editingFrameEvent.type === 'defineComponentUserFunction' && editingFrameEvent.defineComponentUserFunction">
                  <div class="form_row">
                    <div class="form_row_label">
                      ユーザ関数名
                    </div>
  
                    <input type="text" class="form_input_text" v-model="editingFrameEvent.defineComponentUserFunction.name" required>
                  </div>  

                  <div class="form_row">
                    <div class="form_row_label">
                      スクリプト
                    </div>
  
                    <textarea class="form_textarea" v-model="editingFrameEvent.defineComponentUserFunction.content" required></textarea>
                  </div>  

                  <div class="form_row">
                    <button class="form_button" type="button" @click="checkScript(editingFrameEvent.defineComponentUserFunction.content)">スクリプトの構文チェック</button>
                  </div>
                </template>
                                
                <template v-if="editingFrameEvent.type === 'doNothing'">
                  <div class="form_columns_row">
                    <div class="form_row">
                      <div class="form_row_label">
                        ﾌﾚｰﾑｶｳﾝﾄ
                      </div>
    
                      <input type="number" class="form_input_number" v-model="editingFrameEvent.frameCount" required>
                    </div>
                  </div>
                </template>

                <template v-if="editingFrameEvent.type === 'putText' || editingFrameEvent.type === 'putImage'">
                  <div class="form_columns_row">
                    <div class="form_row">
                      <div class="form_row_label">
                        深度
                      </div>
    
                      <input type="number" class="form_input_number" v-model="editingFrameEvent.depth" required min="0" min="-255" max="255">
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        ﾌﾚｰﾑｶｳﾝﾄ
                      </div>
    
                      <input type="number" class="form_input_number" v-model="editingFrameEvent.frameCount" required min="0" @input="onChangeFrameCount">
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        ｵﾌﾞｼﾞｪｸﾄID
                      </div>
  
                      <input type="text" class="form_input_text" v-model="editingFrameEvent.objectId" pattern="^\w+$">
                    </div>  
                  </div>
                  
                  <template v-if="editingFrameEvent.layoutOptions">
                    <div class="form_columns_row">
                      <div class="form_row">
                        <div class="form_row_label">
                          X
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.layoutOptions.x" required>
                      </div>
                      
                      <div class="form_row">
                        <div class="form_row_label">
                          Y
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.layoutOptions.y" required>
                      </div>

                      <div class="form_row">
                        <div class="form_row_label">
                          幅
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.layoutOptions.width" required min="0">
                      </div>
                      
                      <div class="form_row">
                        <div class="form_row_label">
                          高さ
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.layoutOptions.height" required min="0">
                      </div>
                    </div>
                  </template>

                  <div class="form_columns_row">
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickEnableAnimation" :disabled="editingFrameEvent.lastKeyFrame || editingFrameEvent.frameCount < 2">アニメーションを有効化</button>
                    </div>
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickDisableAnimation" :disabled="!editingFrameEvent.lastKeyFrame">アニメーションを削除</button>
                    </div>
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickCentering">左右中央</button>
                    </div>
                  </div>
                  
                  <div class="form_columns_row" v-if="editingFrameEvent.type === 'putImage'">
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickAutoWidth">高さに合わせて幅を設定</button>
                    </div>
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickAutoHeight">幅に合わせて高さを設定</button>
                    </div>
                  </div>

                  <template v-if="editingFrameEvent.lastKeyFrame && editingFrameEvent.lastKeyFrame.layoutOptions">
                    <div class="form_columns_row">
                      <div class="form_row">
                        <div class="form_row_label">
                          移動後X
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.lastKeyFrame.layoutOptions.x" required>
                      </div>
                      
                      <div class="form_row">
                        <div class="form_row_label">
                          Y
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.lastKeyFrame.layoutOptions.y" required>
                      </div>

                      <div class="form_row">
                        <div class="form_row_label">
                          幅
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.lastKeyFrame.layoutOptions.width" required min="0">
                      </div>
                      
                      <div class="form_row">
                        <div class="form_row_label">
                          高さ
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.lastKeyFrame.layoutOptions.height" required min="0">
                      </div>
                    </div>
                  </template>

                  <div class="form_columns_row">
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickEnableClickAction" :disabled="editingFrameEvent.onClickAction">クリック時のアクションを設定</button>
                    </div>
                    <div class="form_row">
                      <button class="form_button" type="button" @click="onClickDisableClickAction" :disabled="!editingFrameEvent.onClickAction">クリック時のアクションを削除</button>
                    </div>
                  </div>

                  <template v-if="editingFrameEvent.onClickAction">
                    <div class="form_row">
                      <div class="form_row_label">
                        アクションの種別
                      </div>
        
                      <select class="form_select" v-model="editingFrameEvent.onClickAction.type" @change="onOnClickActionTypeChanged" required>
                        <option value="eraseLayers">指定深度を消去</option>
                        <option value="play">再生</option>
                        <option value="stop">停止</option>
                        <option value="gotoAndPlay">指定ラベルへジャンプして再生</option>
                        <option value="setTextValue">テキストの表示内容を更新</option>
                        <option value="executeScript">スクリプトを実行</option>
                        <option value="callComponentUserFunction">ユーザ関数を呼び出し</option>
                        <option value="registerGlobalKeydownListener">キー押下リスナーを登録</option>
                        <option value="unregisterGlobalKeydownListener">キー押下リスナーを登録解除</option>
                        <option value="startUserTimer">タイマーを開始</option>
                        <option value="clearUserTimer">タイマーを解除</option>
                      </select>
                    </div>
                    
                    <template v-if="editingFrameEvent.onClickAction.type === 'gotoAndPlay' && editingFrameEvent.onClickAction.gotoAndPlay">
                      <div class="form_row">
                        <div class="form_row_label">
                          ジャンプ先
                        </div>
      
                        <select class="form_input_text" v-model="editingFrameEvent.onClickAction.gotoAndPlay.destination" required>
                          <option v-for="labelName in allLabelNames" :value="labelName">{{labelName}}</option>
                        </select>
                      </div>  
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'eraseLayers' && editingFrameEvent.onClickAction.eraseLayers">
                      <div class="form_row">
                        <div class="form_row_label">
                          深度(全て消去の場合はallと入力)
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.eraseLayers.depths[0]" required pattern="^[0-9]+$|^all$">
                      </div>  
                    </template>
                    
                    <template v-if="editingFrameEvent.onClickAction.type === 'setTextValue' && editingFrameEvent.onClickAction.setTextValue">
                      <div class="form_row">
                        <div class="form_row_label">
                          オブジェクトID
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.setTextValue.objectId" required pattern="^\w+$">
                      </div>
  
                      <div class="form_row">
                        <div class="form_row_label">
                          表示内容
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.setTextValue.value">
                      </div>  
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'callComponentUserFunction' && editingFrameEvent.onClickAction.callComponentUserFunction">
                      <div class="form_row">
                        <div class="form_row_label">
                          ユーザ関数名
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.callComponentUserFunction.name" required>
                      </div>  
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'registerGlobalKeydownListener' && editingFrameEvent.onClickAction.registerGlobalKeydownListener">
                      <div class="form_row">
                        <div class="form_row_label">
                          リスナーID
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.registerGlobalKeydownListener.listenerId" required>
                      </div>
  
                      <div class="form_row">
                        <div class="form_row_label">
                          ユーザ関数名
                        </div>
      
                        <select class="form_input_text" v-model="editingFrameEvent.onClickAction.registerGlobalKeydownListener.componentUserFunctionName" required>
                          <option v-for="labelName in allUserFunctionNames" :value="labelName">{{labelName}}</option>
                        </select>
                      </div>  
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'unregisterGlobalKeydownListener' && editingFrameEvent.onClickAction.unregisterGlobalKeydownListener">
                      <div class="form_row">
                        <div class="form_row_label">
                          リスナーID
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.unregisterGlobalKeydownListener.listenerId" required>
                      </div>
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'startUserTimer' && editingFrameEvent.onClickAction.startUserTimer">
                      <div class="form_row">
                        <div class="form_row_label">
                          リスナーID
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.startUserTimer.listenerId" required>
                      </div>
  
                      <div class="form_row">
                        <div class="form_row_label">
                          ユーザ関数名
                        </div>
      
                        <select class="form_input_text" v-model="editingFrameEvent.onClickAction.startUserTimer.componentUserFunctionName" required>
                          <option v-for="labelName in allUserFunctionNames" :value="labelName">{{labelName}}</option>
                        </select>
                      </div>
                      
                      <div class="form_row">
                        <div class="form_row_label">
                          間隔(1000で1秒)
                        </div>
      
                        <input type="number" class="form_input_number" v-model="editingFrameEvent.onClickAction.startUserTimer.interval" required min="0" max="99999">
                      </div>
                    </template>
  
                    <template v-if="editingFrameEvent.onClickAction.type === 'clearUserTimer' && editingFrameEvent.onClickAction.clearUserTimer">
                      <div class="form_row">
                        <div class="form_row_label">
                          リスナーID
                        </div>
      
                        <input type="text" class="form_input_text" v-model="editingFrameEvent.onClickAction.clearUserTimer.listenerId" required>
                      </div>
                    </template>
                    
                    <template v-if="editingFrameEvent.onClickAction.type === 'executeScript' && editingFrameEvent.onClickAction.executeScript">                    
                      <div class="form_row">
                        <div class="form_row_label">
                          スクリプト
                        </div>
      
                        <textarea class="form_textarea" v-model="editingFrameEvent.onClickAction.executeScript.content" required></textarea>
                      </div>

                      <div class="form_row">
                        <button class="form_button" type="button" @click="checkScript(editingFrameEvent.onClickAction.executeScript.content)">スクリプトの構文チェック</button>
                      </div>  
                    </template>
                  </template>
                </template>

                <template v-if="editingFrameEvent.type === 'putImage' && editingFrameEvent.putImage">
                  <div class="form_columns_row">
                    <div class="form_row">
                      <div class="form_row_label">
                        ｱｾｯﾄID
                      </div>
    
                      <select v-model="editingFrameEvent.putImage.assetId" class="form_input_number" required>
                        <option v-for="assetId in imageAssetIds" :value="assetId">{{assetId}}</option>
                      </select>
                    </div>
                    
                    <div class="form_row">
                      <div class="form_row_label">
                        ﾎﾊﾞｰ時ID
                      </div>
    
                      <select v-model="editingFrameEvent.putImage.hoverAssetId" class="form_input_number">
                        <option value="">未選択</option>
                        <option v-for="assetId in imageAssetIds" :value="assetId">{{assetId}}</option>
                      </select>
                    </div>

                    <div class="form_row">
                      <div class="form_row_label">
                        ｱｸﾃｨﾌﾞ時ID
                      </div>
    
                      <select v-model="editingFrameEvent.putImage.activeAssetId" class="form_input_number">
                        <option value="">未選択</option>
                        <option v-for="assetId in imageAssetIds" :value="assetId">{{assetId}}</option>
                      </select>
                    </div>
                  </div>
                </template>
                
                <template v-if="editingFrameEvent.type === 'putText' && editingFrameEvent.putText">
                  <div class="form_columns_row">
                    <div class="form_row">
                      <div class="form_row_label">
                        ｱｾｯﾄID
                      </div>
    
                      <select v-model="editingFrameEvent.putText.assetId" class="form_input_number" required>
                        <option v-for="assetId in textAssetIds" :value="assetId">{{assetId}}</option>
                      </select>
                    </div>
                  </div>
                </template>
              </div>
  
              <div class="modal_bottom_control">
                <button class="form_button" type="submit">OK</button>
                <button class="form_button" @click="clickCancelEditing" type="button">キャンセル</button>  
              </div>
            </div>
            <div class="modal_content_right">
              <div class="modal_content_right_preview_event" v-show="modalEventPreviewAvailable">
                <div ref="modalEventPreviewWrapper" class="modal_content_right_preview_event_wrapper"></div>
              </div>
            </div>
          </form>
        </div>
      </div>
      
      <div class="editor_layout">
        <div class="editor_menu">
          イベント：
          <button @click="clickNewFrameEvent">追加</button>
          <button @click="clickEditFrameEvent" :disabled="!selectedFrameEvent">編集</button>
          <button @click="clickRemoveFrameEvent" :disabled="!selectedFrameEvent">削除</button>
          <button @click="clickMoveDownwardFrameEvent" :disabled="!selectedFrameEvent || !canMoveDownwardSelected()">下に移動</button>
          <button @click="clickMoveUpwardFrameEvent" :disabled="!selectedFrameEvent || !canMoveUpwardSelected()">上に移動</button>
          <button @click="openPreview()">プレビュー</button>
          アセット：
          <button @click="clickAddTextAsset()" @click="clickAddTextAsset">テキストを追加</button>
          <button @click="clickAddImageAsset()" @click="clickAddImageAsset">画像を追加</button>
          <button @click="clickEditAsset()" :disabled="!selectedAssetId">編集</button>
          <button @click="clickDeleteAsset()" :disabled="!selectedAssetId">削除</button>
          作業：
          <button @click="importingWorkspace=true">読込</button>
          <button @click="downloadWorkspace()">保存準備</button>
          <a v-if="downloadUrl" :href="downloadUrl" download="parahtml_workspace.json" @click="downloadUrl = null">ダウンロード</a>
        </div>
        <div class="editor_columns">
          <div class="editor_left_column">
            <div class="editor_left_column_top">
              <div class="asset_preview" v-show="selectedAsset">
                  <template v-if="selectedAsset?.type === 'image'">
                    <img :src="selectedAsset.image.source" class="asset_preview_image">
                  </template>

                <div ref="textWrapper" v-show="selectedAsset?.type === 'text'"></div>
              </div>
              
              <div class="asset_preview" v-show="selectedEventPreviewAvailable">
                <div class="asset_preview_event">
                  <div ref="eventPreviewWrapper"  class="asset_preview_wrapper"></div>
                </div>
              </div>
            </div>
            <div class="editor_left_column_bottom">
              <table class="asset_table">
                <tr class="asset_table_th">
                  <th style="width: 45px;">アセットID</th>
                  <th>アセット名</th>
                  <th>種別</th>
                </tr>
                <tr v-for="assetId in Object.keys(allIdToAsset)" @click="selectAsset(assetId)" :style="assetRowStyle(assetId)" @dblclick="clickEditAsset">
                  <td class="asset_table_td">{{assetId}}</td>
                  <td class="asset_table_td">{{allIdToAsset[assetId].name}}</td>
                  <td class="asset_table_td">{{allIdToAsset[assetId].type === 'image' ? '画像' : 'テキスト'}}</td>
                </tr>    
              </table>
            </div>
          </div>
          <div class="editor_right_column">
            
            <div v-if="frameEvents">
              <table class="frame_events_table">
                <tr class="frame_events_table_th">
                  <th>フレーム<br />番号</th>
                  <th>フレーム<br />カウント</th>
                  <th>イベント<br />種別</th>
                  <th>深度</th>
                  <th>アクション<br />の動作</th>
                  <th>クリック時の動作</th>
                </tr>
                <tr
                  v-for="(rowItem, index) in frameEvents"
                  :style="frameEventRowStyle(rowItem, index)"
                  @click="selectFrameEvent(rowItem)"
                  @dblclick="clickEditFrameEvent"
                >
                  <td class="frame_events_table_td">{{rowItem['scheduledFrameNumber']}}</td>
                  <td class="frame_events_table_td">{{rowItem['frameCount']}}</td>
                  <td class="frame_events_table_td">{{eventTypeI18n(rowItem)}}</td>
                  <td class="frame_events_table_td">{{rowItem['depth']}}</td>
                  <td  class="frame_events_table_td">{{actionI18n(rowItem['executeAction'])}}</td>
                  <td class="frame_events_table_td">{{actionI18n(rowItem['onClickAction'])}}</td>
                </tr>
              </table>
            </div>
      
          </div>
        </div>
      </div>
    </body>
</html>
