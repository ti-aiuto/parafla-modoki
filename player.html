<!DOCTYPE html>
<html>
  <head>
    <script src="compiler.js" type="text/javascript"></script>
    <script src="render.js" type="text/javascript"></script>
    <script src="samples/typing.js" type="text/javascript"></script>
    <script type="text/javascript">
      function main() {
        const frameEvents = window.frameEvents;
        const scheduleFrameEvents = window.scheduleFrameEvents;

        const renderer = window.renderer;
        const calcualteLabelFrameCount = window.calcualteLabelFrameCount;

        const controller = (function () {
          const instance = {};

          instance.load = function (frameEvents) {
            instance.labelToFrameCount = calcualteLabelFrameCount(frameEvents);
            instance.currentFrameCount = 1;
            instance.jumpToFrameCount = null;

            // 表示データ(外部RAMのイメージ)
            instance.depthToLayer = {};

            instance.absoluteFrameCountToScheduledFrameEvents =
              scheduleFrameEvents(frameEvents);
            console.log(instance.absoluteFrameCountToScheduledFrameEvents);

            // 最後まで達したら最初に戻るため
            instance.lastFrameCount = Math.max.apply(
              null,
              Object.keys(instance.absoluteFrameCountToScheduledFrameEvents)
            );

            // ユーザが好きに使っていい変数
            instance.userVariables = {};

            // TODO: ダミーの値を設定
            instance.rootInstanceId = "rootDummyHoge";

            instance.userResources = {
              1: {
                type: "image",
                image: {
                  source:
                    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InBhZ2UxLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45Mi40ICg1ZGE2ODljMzEzLCAyMDE5LTAxLTE0KSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczIiIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIxLjIzODU4MSIKICAgICBpbmtzY2FwZTpjeD0iMTEyLjgzMjI1IgogICAgIGlua3NjYXBlOmN5PSIxODAuNjE5NDUiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9Im1tIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgdW5pdHM9InB4IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5OTEiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii05IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTUiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IuODrOOCpOODpOODvCAxIgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC0xNjkuOTk5OTgpIj4KICAgIDxyZWN0CiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZiZmJmZjtmaWxsLW9wYWNpdHk6MC45NTE4MDcyO3N0cm9rZTojODJhMWQ2O3N0cm9rZS13aWR0aDoxLjIxMzMwMTQyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6MTtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTtwYWludC1vcmRlcjptYXJrZXJzIGZpbGwgc3Ryb2tlIgogICAgICAgaWQ9InJlY3QyMiIKICAgICAgIHdpZHRoPSIxNjkuMzMzMzMiCiAgICAgICBoZWlnaHQ9IjEyNyIKICAgICAgIHg9IjAiCiAgICAgICB5PSIxNjkuOTk5OTgiCiAgICAgICByeT0iMCIgLz4KICAgIDx0ZXh0CiAgICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MTAuNTgzMzMzMDJweDtsaW5lLWhlaWdodDoxLjI1O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bGV0dGVyLXNwYWNpbmc6MHB4O3dvcmQtc3BhY2luZzowcHg7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIgogICAgICAgeD0iNDYuNTY4NzQ4IgogICAgICAgeT0iMjM4LjI1NSIKICAgICAgIGlkPSJ0ZXh0NDUzNCI+PHRzcGFuCiAgICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICAgIGlkPSJ0c3BhbjQ1MzIiCiAgICAgICAgIHg9IjQ2LjU2ODc0OCIKICAgICAgICAgeT0iMjM4LjI1NSIKICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1zaXplOjE2LjkzMzMzMjQ0cHg7Zm9udC1mYW1pbHk6SEdTR290aGljTTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkhHU0dvdGhpY007c3Ryb2tlLXdpZHRoOjAuMjY0NTgzMzIiPjHjg5rjg7zjgrjnm648L3RzcGFuPjwvdGV4dD4KICA8L2c+Cjwvc3ZnPgo=",
                },
              },
              2: {
                type: "image",
                image: {
                  source:
                    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InBhZ2UyLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45Mi40ICg1ZGE2ODljMzEzLCAyMDE5LTAxLTE0KSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczIiIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIxLjIzODU4MSIKICAgICBpbmtzY2FwZTpjeD0iLTQ0LjYwNTk3NyIKICAgICBpbmtzY2FwZTpjeT0iMTgwLjYxOTQ1IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJtbSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHVuaXRzPSJweCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iOTkxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE1Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSLjg6zjgqTjg6Tjg7wgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTY5Ljk5OTk4KSI+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjAuOTUxODA3MjtzdHJva2U6I2YxOTQ5NDtzdHJva2Utd2lkdGg6MS4yMTMzMDE0MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIKICAgICAgIGlkPSJyZWN0MjIiCiAgICAgICB3aWR0aD0iMTY5LjMzMzMzIgogICAgICAgaGVpZ2h0PSIxMjciCiAgICAgICB4PSIwIgogICAgICAgeT0iMTY5Ljk5OTk4IgogICAgICAgcnk9IjAiIC8+CiAgICA8dGV4dAogICAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjEwLjU4MzMzMzAycHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiIKICAgICAgIHg9IjQ2LjU2ODc0OCIKICAgICAgIHk9IjIzOC4yNTUiCiAgICAgICBpZD0idGV4dDQ1MzQiPjx0c3BhbgogICAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgICBpZD0idHNwYW40NTMyIgogICAgICAgICB4PSI0Ni41Njg3NDgiCiAgICAgICAgIHk9IjIzOC4yNTUiCiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtc2l6ZToxNi45MzMzMzI0NHB4O2ZvbnQtZmFtaWx5OkhHU0dvdGhpY007LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpIR1NHb3RoaWNNO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIj4y44Oa44O844K455uuPC90c3Bhbj48L3RleHQ+CiAgPC9nPgo8L3N2Zz4K",
                },
              },
              3: {
                type: "image",
                image: {
                  source:
                    "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InBhZ2UzLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45Mi40ICg1ZGE2ODljMzEzLCAyMDE5LTAxLTE0KSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczIiIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIxLjIzODU4MSIKICAgICBpbmtzY2FwZTpjeD0iLTQ4LjY0Mjg1NyIKICAgICBpbmtzY2FwZTpjeT0iMTgwLjYxOTQ1IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJtbSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHVuaXRzPSJweCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iOTkxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE1Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSLjg6zjgqTjg6Tjg7wgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTY5Ljk5OTk4KSI+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjAuOTUxODA3MjtzdHJva2U6Izc1ZTE2NztzdHJva2Utd2lkdGg6MS4yMTMzMDE0MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIKICAgICAgIGlkPSJyZWN0MjIiCiAgICAgICB3aWR0aD0iMTY5LjMzMzMzIgogICAgICAgaGVpZ2h0PSIxMjciCiAgICAgICB4PSIwIgogICAgICAgeT0iMTY5Ljk5OTk4IgogICAgICAgcnk9IjAiIC8+CiAgICA8dGV4dAogICAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjEwLjU4MzMzMzAycHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiIKICAgICAgIHg9IjQ2LjU2ODc0OCIKICAgICAgIHk9IjIzOC4yNTUiCiAgICAgICBpZD0idGV4dDQ1MzQiPjx0c3BhbgogICAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgICBpZD0idHNwYW40NTMyIgogICAgICAgICB4PSI0Ni41Njg3NDgiCiAgICAgICAgIHk9IjIzOC4yNTUiCiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtc2l6ZToxNi45MzMzMzI0NHB4O2ZvbnQtZmFtaWx5OkhHU0dvdGhpY007LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpIR1NHb3RoaWNNO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIj4z44Oa44O844K455uuPC90c3Bhbj48L3RleHQ+CiAgPC9nPgo8L3N2Zz4K",
                },
              },
              11: {
                type: "text",
                text: {
                  content: "image1",
                  borderColor: "#000000",
                  borderStyle: "solid",
                  borderWidth: "1",
                  backgroundColor: "#ffffff",
                },
              },
              12: {
                type: "text",
                text: {
                  content: "image2",
                  borderColor: "#000000",
                  borderStyle: "solid",
                  borderWidth: "1",
                  backgroundColor: "#ffffff",
                },
              },
              21: {
                type: "text",
                text: {
                  content: "",
                  borderColor: "#000000",
                  borderStyle: "solid",
                  borderWidth: "1",
                  editable: true,
                },
              },
              22: {
                type: "text",
                text: {
                  content: "計算",
                  borderColor: "#000000",
                  borderStyle: "solid",
                  borderWidth: "1",
                },
              },
              31: {                
                type: "image",
                name: 'タイピングタイトルスクリーン',
                image: {
                  source: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InR5cGV0aXRsZS5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuNCAoNWRhNjg5YzMxMywgMjAxOS0wMS0xNCkiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMyIiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMS4yMzg1ODEiCiAgICAgaW5rc2NhcGU6Y3g9IjI3NC4zMDczNiIKICAgICBpbmtzY2FwZTpjeT0iMTgwLjYxOTQ1IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJtbSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHVuaXRzPSJweCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iOTkxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE1Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSLjg6zjgqTjg6Tjg7wgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTY5Ljk5OTk4KSI+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYmZiZmY7ZmlsbC1vcGFjaXR5OjAuOTUxODA3MjtzdHJva2U6IzgyYTFkNjtzdHJva2Utd2lkdGg6MS4yMTMzMDE0MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIKICAgICAgIGlkPSJyZWN0MjIiCiAgICAgICB3aWR0aD0iMTY5LjMzMzMzIgogICAgICAgaGVpZ2h0PSIxMjciCiAgICAgICB4PSIwIgogICAgICAgeT0iMTY5Ljk5OTk4IgogICAgICAgcnk9IjAiIC8+CiAgICA8dGV4dAogICAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjEwLjU4MzMzMzAycHg7bGluZS1oZWlnaHQ6MS4yNTtmb250LWZhbWlseTpzYW5zLXNlcmlmO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiIKICAgICAgIHg9IjMzLjUzODA0NCIKICAgICAgIHk9IjIwOC4zNDg0NiIKICAgICAgIGlkPSJ0ZXh0NDUzNCI+PHRzcGFuCiAgICAgICAgIHNvZGlwb2RpOnJvbGU9ImxpbmUiCiAgICAgICAgIGlkPSJ0c3BhbjQ1MzIiCiAgICAgICAgIHg9IjMzLjUzODA0NCIKICAgICAgICAgeT0iMjA4LjM0ODQ2IgogICAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDtmb250LXNpemU6MTYuOTMzMzMyNDRweDtmb250LWZhbWlseTpIR1NHb3RoaWNNOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246SEdTR290aGljTTtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiI+44K/44Kk44OI44Or55S76Z2iPC90c3Bhbj48L3RleHQ+CiAgPC9nPgo8L3N2Zz4K",
                },
              },
              32: {                
                type: "image",
                name: 'タイピング説明画面',
                image: {
                  source: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InR5cGVob3d0by5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuNCAoNWRhNjg5YzMxMywgMjAxOS0wMS0xNCkiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMyIiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMS4yMzg1ODEiCiAgICAgaW5rc2NhcGU6Y3g9IjMzOC44OTc0IgogICAgIGlua3NjYXBlOmN5PSIxODAuNjE5NDUiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9Im1tIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImxheWVyMSIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgdW5pdHM9InB4IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5OTEiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii05IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTUiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IuODrOOCpOODpOODvCAxIgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC0xNjkuOTk5OTgpIj4KICAgIDxyZWN0CiAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZiZmJmZjtmaWxsLW9wYWNpdHk6MC45NTE4MDcyO3N0cm9rZTojODJhMWQ2O3N0cm9rZS13aWR0aDoxLjIxMzMwMTQyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6MTtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTtwYWludC1vcmRlcjptYXJrZXJzIGZpbGwgc3Ryb2tlIgogICAgICAgaWQ9InJlY3QyMiIKICAgICAgIHdpZHRoPSIxNjkuMzMzMzMiCiAgICAgICBoZWlnaHQ9IjEyNyIKICAgICAgIHg9IjAiCiAgICAgICB5PSIxNjkuOTk5OTgiCiAgICAgICByeT0iMCIgLz4KICAgIDx0ZXh0CiAgICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MTAuNTgzMzMzMDJweDtsaW5lLWhlaWdodDoxLjI1O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bGV0dGVyLXNwYWNpbmc6MHB4O3dvcmQtc3BhY2luZzowcHg7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIgogICAgICAgeD0iNTAuNDEzODc2IgogICAgICAgeT0iMjAzLjAwODAxIgogICAgICAgaWQ9InRleHQ0NTM0Ij48dHNwYW4KICAgICAgICAgc29kaXBvZGk6cm9sZT0ibGluZSIKICAgICAgICAgaWQ9InRzcGFuNDUzMiIKICAgICAgICAgeD0iNTAuNDEzODc2IgogICAgICAgICB5PSIyMDMuMDA4MDEiCiAgICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO2ZvbnQtc2l6ZToxNi45MzMzMzI0NHB4O2ZvbnQtZmFtaWx5OkhHU0dvdGhpY007LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpIR1NHb3RoaWNNO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIj7oqqzmmI7nlLvpnaI8L3RzcGFuPjwvdGV4dD4KICAgIDx0ZXh0CiAgICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MTAuNTgzMzMzMDJweDtsaW5lLWhlaWdodDoxLjI1O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bGV0dGVyLXNwYWNpbmc6MHB4O3dvcmQtc3BhY2luZzowcHg7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIgogICAgICAgeD0iMTkuMDYyMzc0IgogICAgICAgeT0iMjMxLjY3MDgxIgogICAgICAgaWQ9InRleHQ0NTM0LTkiPjx0c3BhbgogICAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgICBpZD0idHNwYW40NTMyLTMiCiAgICAgICAgIHg9IjE5LjA2MjM3NCIKICAgICAgICAgeT0iMjMxLjY3MDgxIgogICAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDtmb250LXNpemU6Ny43NjExMTExMXB4O2ZvbnQtZmFtaWx5OkhHU0dvdGhpY007LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpIR1NHb3RoaWNNO3N0cm9rZS13aWR0aDowLjI2NDU4MzMyIj7jgYLjgYLjgYLjgYLjgYI8L3RzcGFuPjwvdGV4dD4KICA8L2c+Cjwvc3ZnPgo=",
                },
              },
              33: {                
                type: "image",
                name: 'タイピングプレイ中背景',
                image: {
                  source: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNjQwIgogICBoZWlnaHQ9IjQ4MCIKICAgdmlld0JveD0iMCAwIDE2OS4zMzMzMyAxMjciCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9InR5cGViZy5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuNCAoNWRhNjg5YzMxMywgMjAxOS0wMS0xNCkiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMyIiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMS4yMzg1ODEiCiAgICAgaW5rc2NhcGU6Y3g9IjQwMy40ODc0NCIKICAgICBpbmtzY2FwZTpjeT0iMTgwLjYxOTQ1IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJtbSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHVuaXRzPSJweCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iOTkxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTkiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE1Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSLjg6zjgqTjg6Tjg7wgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTY5Ljk5OTk4KSI+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmYmZiZmY7ZmlsbC1vcGFjaXR5OjAuOTUxODA3MjtzdHJva2U6IzgyYTFkNjtzdHJva2Utd2lkdGg6MS4yMTMzMDE0MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjE7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIKICAgICAgIGlkPSJyZWN0MjIiCiAgICAgICB3aWR0aD0iMTY5LjMzMzMzIgogICAgICAgaGVpZ2h0PSIxMjciCiAgICAgICB4PSIwIgogICAgICAgeT0iMTY5Ljk5OTk4IgogICAgICAgcnk9IjAiIC8+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjAuOTUxODA3MTg7c3Ryb2tlOiM3NWUxNjc7c3Ryb2tlLXdpZHRoOjEuMjEwOTk5OTc7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDoxO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxO3BhaW50LW9yZGVyOm1hcmtlcnMgZmlsbCBzdHJva2UiCiAgICAgICBpZD0icmVjdDgxNSIKICAgICAgIHdpZHRoPSIxNTIuNzM2OTQiCiAgICAgICBoZWlnaHQ9IjMuODQ1MTI1OSIKICAgICAgIHg9IjguMzMxMTA2MiIKICAgICAgIHk9IjI0MS44ODY1MSIgLz4KICA8L2c+Cjwvc3ZnPgo=",
                },
              },

            };
          };

          instance.findResourceById = function (id) {
            return instance.userResources[id];
          };

          instance.play = function () {
            instance.timerId = setInterval(this.tick, 100);
          };
          instance.stop = function () {
            clearInterval(instance.timerId);
          };
          instance.eraseLayers = function (depths) {
            if (depths.includes("all")) {
              Object.keys(instance.depthToLayer).forEach(function (eachDepth) {
                instance.depthToLayer[eachDepth] = undefined;
              });
            } else {
              depths.forEach(function (eachDepth) {
                instance.depthToLayer[eachDepth] = undefined;
              });
            }
          };
          instance.gotoAndPlay = function (destination) {
            // TODO: 本当はここでバリデーションが必要
            if (typeof destination === "string") {
              instance.jumpToFrameCount = Number(
                instance.labelToFrameCount[destination]
              );
            } else {
              instance.jumpToFrameCount = destination;
            }
            instance.play();
          };
          instance.setUserVariable = function (key, value) {
            instance.userVariables[key] = JSON.stringify(value);
            console.log("ユーザ変数設定", key, instance.userVariables[key]);
          };
          instance.getUserVariable = function (key) {
            console.log("ユーザ変数取得", key, instance.userVariables[key]);
            if (instance.userVariables[key] !== undefined) {
              return JSON.parse(instance.userVariables[key]);
            } else {
              return undefined;
            }
          };

          instance.handleAction = function (action) {
            const context = {
              play() {
                controller.play();
              },
              stop() {
                controller.stop();
              },
              gotoAndPlay(destination) {
                controller.gotoAndPlay(destination);
              },
              eraseLayers(depths) {
                controller.eraseLayers(depths);
              },
              setUserVariable(key, value) {
                controller.setUserVariable(key, value);
              },
              getUserVariable(key) {
                return controller.getUserVariable(key);
              },
              findTextObjectById(id) {
                return renderer.findTextObjectById(id);
              },
            };

            // stop, gotoAndPlayはframeCountが1になる
            // defineLabel, eraseLayersはframeCountは0
            if (action.type === "eraseLayers") {
              context.eraseLayers(action.eraseLayers.depths);
            } else if (action.type === "stop") {
              context.stop();
            } else if (action.type === "play") {
              context.play();
            } else if (action.type === "gotoAndPlay") {
              context.gotoAndPlay(action.gotoAndPlay.destination);
            } else if (action.type === "executeScript") {
              const func = new Function(
                "context",
                action.executeScript.content
              );
              func(context);
            }
          };

          instance.tick = function () {
            // 最後まで行ったら最初に戻る（判定これでいいのかな？）
            if (instance.currentFrameCount > instance.lastFrameCount) {
              instance.currentFrameCount = 1;
            }

            // 飛び先が指定されていたらそっちにいく
            if (instance.jumpToFrameCount !== null) {
              instance.currentFrameCount = instance.jumpToFrameCount;
              instance.jumpToFrameCount = null;
            }

            // console.log(instance.currentFrameCount);

            const currentScheduledFrameEvents =
              instance.absoluteFrameCountToScheduledFrameEvents[
                instance.currentFrameCount
              ] || [];

            currentScheduledFrameEvents.forEach(function (scheduledFrameEvent) {
              const event = scheduledFrameEvent.event;
              const depth = event.depth;

              if (event.type === "executeAction") {
                console.log("executeAction", event.executeAction);
                instance.handleAction(event.executeAction);
              }

              if (event.type === "putImage" || event.type === "putText") {
                let objectBase = null;
                // ここの種別は、画像・テキスト・HTML要素・音声・スプライトなどを想定
                if (event.type === "putImage") {
                  objectBase = {
                    type: "image",
                    image: instance.findResourceById(event.putImage.resourceId)[
                      "image"
                    ],
                    onClickAction: event.onClickAction,
                    objectId: scheduledFrameEvent.objectId,
                  };
                } else if (event.type === "putText") {
                  objectBase = {
                    type: "text",
                    text: instance.findResourceById(event.putText.resourceId)[
                      "text"
                    ],
                    onClickAction: event.onClickAction,
                    objectId: scheduledFrameEvent.objectId,
                  };
                }

                if (scheduledFrameEvent.frameCountInEvent <= 1) {
                  // 0または1
                  // TODO: ここでdepthあるかの判定
                  instance.depthToLayer[depth] = {
                    object: {
                      ...objectBase,
                      useCache: false,
                      layoutOptions: event.layoutOptions,
                    },
                  };
                } else {
                  const before = event.layoutOptions;
                  const after = event.lastKeyFrame.layoutOptions;

                  // TODO: ここでdepthあるかの判定
                  instance.depthToLayer[depth] = {
                    object: {
                      ...objectBase,
                      useCache: true,
                      layoutOptions: {
                        x:
                          before.x +
                          (scheduledFrameEvent.frameCountInEvent *
                            (after.x - before.x)) /
                            event.frameCount,
                        y:
                          before.y +
                          (scheduledFrameEvent.frameCountInEvent *
                            (after.y - before.y)) /
                            event.frameCount,
                        width:
                          before.width +
                          (scheduledFrameEvent.frameCountInEvent *
                            (after.width - before.width)) /
                            event.frameCount,
                        height:
                          before.height +
                          (scheduledFrameEvent.frameCountInEvent *
                            (after.height - before.height)) /
                            event.frameCount,
                      },
                    },
                  };
                }
              }

              renderer.render(instance.depthToLayer, {
                handleAction: instance.handleAction,
                rootInstanceId: instance.rootInstanceId,
              });
            });
            instance.currentFrameCount += 1;
          };

          return instance;
        })();
        controller.load(frameEvents);
        renderer.prepare({
          handleAction: controller.handleAction,
          rootInstanceId: controller.rootInstanceId,
        });
        controller.play();
      }

      window.onload = function () {
        main();
      };
    </script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
